<!DOCTYPE html>
<html lang="id" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riwayat Pesanan - Akun Bareng</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script>
        // Konfigurasi Tailwind (Sama seperti index.html)
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'soft-blue': '#C8E6F7',
                        'deep-blue': '#2563EB',
                        'light-bg': '#F0F8FF',
                        'card-bg': '#FFFFFF',
                        'text-primary': '#1F2937',
                        'accent-wa': '#25D366',
                        'accent-x': '#000000',
                        'accent-tiktok': '#EE1D52',
                        'brand-netflix': '#E50914',
                        'brand-disney': '#113CCF',
                        'brand-youtube': '#FF0000',
                        'brand-viu': '#FF7120',
                        'brand-wetv': '#00B3FF',
                        'brand-iqiyi': '#409930',
                        'brand-vidio': '#FF6600',
                        'brand-canva': '#00C4CC',
                        'brand-vplus': '#FF0000',
                        'brand-aprime': '#232F3E',
                        'brand-hbo': '#5402F0',
                        'brand-vsco': '#000000',
                        'brand-picsart': '#FF4C68',
                        'brand-lroom': '#3D335A',
                        'brand-resso': '#FF0050',
                        'brand-bstation': '#00A1D6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 12px rgba(0, 0, 0, 0.05)',
                        'lg-soft': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                        'hover-strong-blue': '0 25px 45px -10px rgba(59, 130, 246, 0.4), 0 8px 10px -6px rgba(59, 130, 246, 0.25)',
                    }
                }
            }
        }
    </script>
    <style>
        /* ... (Semua CSS lama dari Index.html tetap di sini) ... */

        /* GAYA BARU KHUSUS LIST ORDER */
        .order-card-container {
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 5px solid transparent;
        }

        .order-card-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .order-status {
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        /* Status colors */
        .status-pending {
            background-color: #fef3c7;
            color: #d97706;
        }

        .status-processing {
            background-color: #bfdbfe;
            color: #1d4ed8;
        }

        .status-completed {
            background-color: #d1fae5;
            color: #059669;
        }

        .status-cancelled {
            background-color: #fee2e2;
            color: #ef4444;
        }

        html.dark .status-pending {
            background-color: #433802;
            color: #f59e0b;
        }

        html.dark .status-processing {
            background-color: #1e3a8a;
            color: #60a5fa;
        }

        html.dark .status-completed {
            background-color: #064e3b;
            color: #34d399;
        }

        html.dark .status-cancelled {
            background-color: #7f1d1d;
            color: #f87171;
        }
    </style>
</head>

<body class="min-h-screen pt-16">

    <div id="particle-container-stars" class="particle-container-stars"></div>

    <header id="navbar"
        class="navbar-blur fixed top-0 left-0 w-full z-50 transition-all duration-300 border-b dark:border-gray-700">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="flex items-center justify-between">
                <a href="index.html" class="flex items-center space-x-2">
                    <img src="./image_d0f289.png" alt="Logo Akun Bareng" class="h-8 w-auto">
                    <span class="text-xl font-bold text-deep-blue dark:text-soft-blue">Akun Bareng</span>
                </a>
                <nav class="hidden md:flex space-x-6 items-center">
                    <a href="index.html"
                        class="group text-sm font-medium animated-hover-text text-text-primary dark:text-gray-100">
                        Home
                    </a>
                    <a href="#"
                        class="group text-sm font-medium animated-hover-text text-text-primary dark:text-gray-100">
                        Produk
                    </a>
                    <a href="#"
                        class="group text-sm font-medium animated-hover-text text-text-primary dark:text-gray-100">
                        Testimoni
                    </a>
                    <a href="#"
                        class="group text-sm font-medium animated-hover-text text-text-primary dark:text-gray-100">
                        FAQ
                    </a>
                </nav>

                <div class="flex items-center space-x-4">
                    <button id="theme-toggle-desktop" onclick="toggleTheme()"
                        class="p-2 rounded-full text-gray-500 hover:text-deep-blue dark:text-gray-400 dark:hover:text-soft-blue transition">
                        <i data-lucide="moon" class="w-5 h-5 dark:hidden"></i>
                        <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
                    </button>

                    <div id="auth-links-desktop" class="hidden md:flex items-center space-x-3">
                        <button onclick="showAuthModal('login')"
                            class="px-4 py-2 text-sm font-medium rounded-lg text-white bg-deep-blue hover:bg-blue-700 transition">
                            Login
                        </button>
                    </div>

                    <button id="mobile-menu-button"
                        class="p-2 rounded-full md:hidden text-gray-500 hover:text-deep-blue dark:text-gray-400 dark:hover:text-soft-blue transition">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <div class="max-w-4xl mx-auto">
            <h1
                class="text-3xl sm:text-4xl font-extrabold text-center mb-10 text-text-primary dark:text-gray-50 scroll-appear">
                Riwayat Pesanan Anda
            </h1>
            <p class="text-center text-gray-600 dark:text-gray-400 mb-8 scroll-appear" style="transition-delay: 0.2s;">
                Lihat detail semua pesanan yang pernah Anda lakukan di Akun Bareng.
            </p>

            <div id="loading-state" class="flex justify-center items-center py-20">
                <svg class="loader w-16 h-16" viewBox="0 0 200 200" width="200" height="200" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="mainGradient" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#2563EB" />
                            <stop offset="100%" stop-color="#3b82f6" />
                        </linearGradient>
                    </defs>
                    <radialGradient id="ringGradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                        <stop offset="0%" stop-color="#dbeafe" />
                        <stop offset="100%" stop-color="#93c5fd" />
                    </radialGradient>
                    <circle class="loader-ring loader-ring-a" cx="100" cy="100" r="80" stroke-linecap="round" fill="none"
                        stroke-width="20" stroke="url(#mainGradient)" stroke-dasharray="0 660" stroke-dashoffset="-330"></circle>
                    <circle class="loader-ring loader-ring-b" cx="100" cy="100" r="80" stroke-linecap="round" fill="none"
                        stroke-width="20" stroke="url(#mainGradient)" stroke-dasharray="0 660" stroke-dashoffset="-110"></circle>
                    <circle class="loader-ring loader-ring-c" cx="100" cy="100" r="80" stroke-linecap="round" fill="none"
                        stroke-width="20" stroke="url(#mainGradient)" stroke-dasharray="0 660" stroke-dashoffset="0"></circle>
                    <circle class="loader-ring loader-ring-d" cx="100" cy="100" r="80" stroke-linecap="round" fill="none"
                        stroke-width="20" stroke="url(#mainGradient)" stroke-dasharray="0 660" stroke-dashoffset="0"></circle>
                </svg>
            </div>


            <div id="order-list-container" class="space-y-6 hidden">
                </div>

            <div id="empty-state" class="hidden text-center py-20 bg-gray-50 dark:bg-gray-800 rounded-xl shadow-inner mt-10" style="transition-delay: 0.3s;">
                <i data-lucide="package-open" class="w-12 h-12 mx-auto text-gray-400 mb-4"></i>
                <h3 class="text-xl font-semibold text-text-primary dark:text-gray-100 mb-2">Belum Ada Pesanan</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6">Anda belum memiliki riwayat pesanan. Mulai berbelanja sekarang!</p>
                <a href="index.html" class="px-6 py-2 bg-deep-blue text-white rounded-lg hover:bg-blue-700 transition font-medium">
                    Lihat Produk
                </a>
            </div>

        </div>
    </main>

    <footer class="bg-gray-100 dark:bg-gray-900 mt-16 py-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h5 class="text-lg font-bold text-text-primary dark:text-white mb-4">Akun Bareng</h5>
                    <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                        <li><a href="index.html#home" class="hover:text-deep-blue dark:hover:text-soft-blue transition">Home</a></li>
                        <li><a href="index.html#products"
                                class="hover:text-deep-blue dark:hover:text-soft-blue transition">Produk</a></li>
                        <li><a href="index.html#testimonials"
                                class="hover:text-deep-blue dark:hover:text-soft-blue transition">Testimoni</a></li>
                        <li><a href="index.html#faq"
                                class="hover:text-deep-blue dark:hover:text-soft-blue transition">FAQ</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="text-lg font-bold text-text-primary dark:text-white mb-4">Layanan & Bantuan</h5>
                    <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                        <li><a href="#" class="hover:text-deep-blue dark:hover:text-soft-blue transition">Cara Order</a></li>
                        <li><a href="#" class="hover:text-deep-blue dark:hover:text-soft-blue transition">Kontak Kami</a></li>
                        <li><a href="#" class="hover:text-deep-blue dark:hover:text-soft-blue transition">Kebijakan Privasi</a></li>
                        <li><a href="#" class="hover:text-deep-blue dark:hover:text-soft-blue transition">Syarat & Ketentuan</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="text-lg font-bold text-text-primary dark:text-white mb-4">Tautan Cepat</h5>
                    <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                        <li><a href="listorder.html" class="hover:text-deep-blue dark:hover:text-soft-blue transition">Riwayat Pesanan</a></li>
                        <li><a href="admin.html" class="hover:text-deep-blue dark:hover:text-soft-blue transition">Admin Panel</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="text-lg font-bold text-text-primary dark:text-white mb-4">Ikuti Kami</h5>
                    <div class="flex space-x-4">
                        <a href="https://wa.me/628123456789" target="_blank"
                            class="text-accent-wa hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 transition">
                            <i data-lucide="message-square" class="w-6 h-6"></i>
                        </a>
                        <a href="https://twitter.com/contoh" target="_blank"
                            class="text-accent-x hover:text-gray-600 dark:text-gray-100 dark:hover:text-gray-300 transition">
                            <i data-lucide="twitter" class="w-6 h-6"></i>
                        </a>
                        <a href="https://tiktok.com/contoh" target="_blank"
                            class="text-accent-tiktok hover:text-pink-600 dark:text-pink-500 dark:hover:text-pink-400 transition">
                            <i data-lucide="sparkles" class="w-6 h-6"></i>
                        </a>
                    </div>
                </div>
            </div>

            <div class="mt-12 border-t pt-8 border-gray-300 dark:border-gray-700 text-center">
                <p class="text-sm text-gray-500 dark:text-gray-400">&copy; 2024 Akun Bareng. All rights reserved.</p>
                <div class="flex justify-center space-x-4 mt-2">
                    <p class="text-xs text-gray-500 dark:text-gray-400">Made with ðŸ’™ by Avee Developer</p>
                </div>
            </div>
        </div>
    </footer>
    <div id="bottom-menu-bar"
        class="fixed bottom-4 left-1/2 -translate-x-1/2 z-40 md:hidden transition-all duration-300 transform-gpu opacity-100 visible">
        <div class="bottom-menu-container">
            <a href="index.html" class="bottom-menu-link">
                <i data-lucide="home" class="bottom-menu-icon"></i>
                <span class="bottom-menu-title">Home</span>
            </a>
            <a href="listorder.html" class="bottom-menu-link active">
                <i data-lucide="package" class="bottom-menu-icon"></i>
                <span class="bottom-menu-title">Pesanan</span>
            </a>

            <div id="integrated-fab-wrapper">
                <button id="integrated-fab-toggle" onclick="toggleFab(event)" class="bottom-menu-link !w-auto !px-4 !py-0 !h-12 !bg-deep-blue !text-white !justify-center hover:!bg-blue-700 transition">
                    <i data-lucide="user" class="bottom-menu-icon !w-5 !h-5 !mr-2"></i>
                    <span class="bottom-menu-title !text-base !font-semibold !opacity-100 !max-w-full !transition-none">Akun</span>
                </button>
                <div id="integrated-fab-menu" class="integrated-fab-menu-content">
                    <a href="#" onclick="showAuthModal('login')" id="fab-login-btn"
                        class="integrated-fab-item">
                        <i data-lucide="log-in" class="w-5 h-5"></i> Login
                    </a>
                    <a href="listorder.html" class="integrated-fab-item hidden" id="fab-orders-btn">
                        <i data-lucide="list-ordered" class="w-5 h-5"></i> Riwayat
                    </a>
                    <a href="admin.html" class="integrated-fab-item hidden" id="fab-admin-btn">
                        <i data-lucide="shield" class="w-5 h-5"></i> Admin
                    </a>
                    <button onclick="handleLogout()" id="fab-logout-btn"
                        class="integrated-fab-item hidden !text-red-500 hover:!bg-red-50 dark:hover:!bg-gray-700">
                        <i data-lucide="log-out" class="w-5 h-5"></i> Logout
                    </button>
                </div>
            </div>
            <button onclick="toggleTheme()" class="bottom-menu-link">
                <i data-lucide="moon" class="bottom-menu-icon dark:hidden"></i>
                <i data-lucide="sun" class="bottom-menu-icon hidden dark:block"></i>
                <span class="bottom-menu-title">Tema</span>
            </button>
        </div>
    </div>
    <script>
        /*
         ==========================================================================
         FUNGSI GLOBAL (SAMA DENGAN INDEX.HTML)
         ==========================================================================
        */

        const USER_KEY = 'currentUser';
        const TOKEN_KEY = 'userToken';

        // --- 1. Simulasi Data ---
        // ID pengguna dummy yang sedang login
        const loggedInUserId = 'user-123'; // Ganti ini untuk simulasi user lain, atau null jika belum login
        // Data pengguna dummy (Sama seperti di index.html)
        const USERS = [
            { id: 'user-123', email: 'user@example.com', role: 'user', name: 'Avee User' },
            { id: 'admin-456', email: 'admin@example.com', role: 'admin', name: 'Avee Admin' }
        ];

        // Data pesanan dummy
        const ORDERS = [
            { id: 'ORD-94759', userId: 'user-123', product: 'Netflix Premium 1 Bulan', total: 50000, date: '2024-11-10', detail: 'Akun sharing, P1', status: 'completed' },
            { id: 'ORD-88210', userId: 'user-123', product: 'Spotify Premium 3 Bulan', total: 75000, date: '2024-11-12', detail: 'Akun sendiri, Invite', status: 'processing' },
            { id: 'ORD-75102', userId: 'user-123', product: 'Canva Pro 1 Tahun', total: 120000, date: '2024-11-14', detail: 'Via link, Email: user@example.com', status: 'pending' },
            { id: 'ORD-60031', userId: 'user-123', product: 'Disney+ Hotstar 6 Bulan', total: 100000, date: '2024-11-05', detail: 'Akun sharing, P2', status: 'cancelled' },
            { id: 'ORD-54321', userId: 'user-999', product: 'Viu Premium 1 Bulan', total: 20000, date: '2024-11-01', detail: 'Akun sharing, P1', status: 'completed' }, // Pesanan user lain
        ];

        // --- 2. Fungsi Helper UI ---

        /**
         * Mengubah angka menjadi format Rupiah.
         * @param {number} number Angka yang akan diformat.
         * @returns {string} String dalam format Rp X.XXX
         */
        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        }

        /**
         * Mengambil kelas CSS untuk styling status pesanan.
         * @param {string} status Status pesanan ('pending', 'processing', 'completed', 'cancelled').
         * @returns {string} Kelas CSS Tailwind.
         */
        function getStatusClass(status) {
            switch (status) {
                case 'pending':
                    return 'status-pending';
                case 'processing':
                    return 'status-processing';
                case 'completed':
                    return 'status-completed';
                case 'cancelled':
                    return 'status-cancelled';
                default:
                    return 'bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200';
            }
        }

        /**
         * Fungsi untuk menyalin teks ke clipboard.
         * @param {string} text Teks yang akan disalin.
         */
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert(`ID Pesanan ${text} berhasil disalin!`);
            }).catch(err => {
                console.error('Gagal menyalin:', err);
            });
        }
        window.copyToClipboard = copyToClipboard; // Daftarkan sebagai global

        // --- 3. Fungsi Autentikasi dan Logout (Sama dengan index.html) ---

        /**
         * Memeriksa status otentikasi. Jika tidak ada token, paksa logout.
         * @returns {object|null} Data user yang sedang login atau null.
         */
        function checkAuth() {
            const token = localStorage.getItem(TOKEN_KEY);
            const userJSON = localStorage.getItem(USER_KEY);
            const user = userJSON ? JSON.parse(userJSON) : null;

            // Simulasikan Auth Guard: Jika tidak ada token/user, redirect ke Home
            if (!token || !user) {
                alert('Anda harus login untuk melihat riwayat pesanan.');
                window.location.href = 'index.html';
                return null;
            }

            // Simulasikan validasi token (nyata): Cari user di data dummy
            const validUser = USERS.find(u => u.id === user.id && u.email === user.email);

            if (!validUser) {
                handleLogout(); // Hapus token/data yang tidak valid
                alert('Sesi tidak valid. Silakan login kembali.');
                window.location.href = 'index.html';
                return null;
            }

            return validUser;
        }

        /**
         * Menangani proses logout.
         */
        function handleLogout() {
            localStorage.removeItem(TOKEN_KEY);
            localStorage.removeItem(USER_KEY);
            localStorage.removeItem('isAdmin');
            // Arahkan ke halaman utama setelah logout
            window.location.href = 'index.html';
        }
        window.handleLogout = handleLogout; // Daftarkan sebagai global

        // Fungsi untuk mengaktifkan Dark Mode
        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
            lucide.createIcons(); // Re-render Lucide icons
        }
        window.toggleTheme = toggleTheme; // Daftarkan sebagai global

        // --- 4. Fungsi Khusus Riwayat Pesanan ---

        /**
         * Memuat pesanan untuk pengguna yang sedang login.
         */
        function loadUserOrders() {
            const user = checkAuth(); // Panggil Auth Guard

            if (!user) {
                return; // Berhenti jika gagal Auth
            }

            const loadingState = document.getElementById('loading-state');
            const orderContainer = document.getElementById('order-list-container');
            const emptyState = document.getElementById('empty-state');

            // Tampilkan loading, sembunyikan container
            loadingState.classList.remove('hidden');
            orderContainer.classList.add('hidden');
            emptyState.classList.add('hidden');

            // Simulasi fetch data (delay 1 detik)
            setTimeout(() => {
                const userOrders = ORDERS.filter(order => order.userId === user.id);

                loadingState.classList.add('hidden'); // Sembunyikan loading

                if (userOrders.length === 0) {
                    emptyState.classList.remove('hidden'); // Tampilkan empty state
                } else {
                    renderOrders(userOrders, orderContainer);
                    orderContainer.classList.remove('hidden'); // Tampilkan order list
                }

                lucide.createIcons(); // Re-render Lucide icons setelah DOM diperbarui
            }, 1000);
        }

        /**
         * Merender daftar pesanan ke dalam kontainer.
         * @param {Array<Object>} orders Array objek pesanan.
         * @param {HTMLElement} container Elemen DOM tempat pesanan akan ditampilkan.
         */
        function renderOrders(orders, container) {
            let html = '';
            orders.forEach(order => {
                const statusClass = getStatusClass(order.status);
                const statusText = order.status.charAt(0).toUpperCase() + order.status.slice(1); // Kapitalisasi
                
                // Tambahkan class border berdasarkan status
                let borderClass = 'border-l-blue-500'; // Default
                if (order.status === 'completed') borderClass = 'border-l-green-500';
                else if (order.status === 'cancelled') borderClass = 'border-l-red-500';
                else if (order.status === 'pending') borderClass = 'border-l-yellow-500';
                
                // Card untuk setiap pesanan
                html += `
                    <div class="order-card-container bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-xl shadow-lg dark:shadow-xl hover:shadow-2xl transition-all duration-300 border border-gray-100 dark:border-gray-700 ${borderClass}">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b pb-3 mb-3 dark:border-gray-700">
                            <div class="flex items-center space-x-2 mb-2 sm:mb-0">
                                <span class="text-xs font-semibold text-gray-500 dark:text-gray-400">#${order.id}</span>
                                <span class="order-status ${statusClass}">${statusText}</span>
                            </div>
                            <div class="text-lg font-bold text-deep-blue dark:text-soft-blue">${formatRupiah(order.total)}</div>
                        </div>
                        <div class="grid grid-cols-2 gap-y-2 text-sm text-gray-700 dark:text-gray-300">
                            <div>
                                <span class="font-medium text-text-primary dark:text-gray-100">Produk:</span>
                                ${order.product}
                            </div>
                            <div>
                                <span class="font-medium text-text-primary dark:text-gray-100">Tanggal:</span>
                                ${order.date}
                            </div>
                            <div class="col-span-2">
                                <span class="font-medium text-text-primary dark:text-gray-100">Detail:</span>
                                ${order.detail}
                            </div>
                        </div>
                        <div class="flex justify-end mt-4 pt-4 border-t dark:border-gray-700">
                            <button onclick="copyToClipboard('${order.id}')"
                                class="text-sm text-deep-blue hover:text-blue-700 dark:text-soft-blue dark:hover:text-blue-400 transition flex items-center">
                                <i data-lucide="copy" class="w-4 h-4 mr-1"></i>
                                Salin ID
                            </button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // --- 5. Initialisasi Saat Halaman Dimuat (DOM Ready) ---

        document.addEventListener('DOMContentLoaded', () => {
            // Muat data pesanan pengguna (termasuk Auth Guard)
            loadUserOrders();

            // Panggil fungsi-fungsi inisialisasi lain
            initScrollAppear();
            initNavbarBlur();
            initTheme();
            initFabLinks();
            lucide.createIcons();
        });

        // --- 6. Fungsi Inisialisasi Lain (Dari Index.html) ---

        function initNavbarBlur() {
            const navbar = document.getElementById('navbar');
            if (!navbar) return;
            const toggleNavbarBlur = () => {
                if (window.scrollY > 50) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            };
            window.addEventListener('scroll', toggleNavbarBlur);
            toggleNavbarBlur();
        }
        
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        function initScrollAppear() {
            const elements = document.querySelectorAll('.scroll-appear');
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1
            });
            elements.forEach(element => observer.observe(element));
        }

        function toggleFab(event) {
            event.stopPropagation();
            const fabWrapper = document.getElementById('integrated-fab-wrapper');
            fabWrapper.classList.toggle('active');
        }
        window.toggleFab = toggleFab;
        
        function closeFabMenu(event) {
            const fabWrapper = document.getElementById('integrated-fab-wrapper');
            if (fabWrapper && fabWrapper.classList.contains('active')) {
                // Periksa apakah klik BUKAN di dalam wrapper FAB
                if (!fabWrapper.contains(event.target)) {
                    fabWrapper.classList.remove('active');
                }
            }
        }
        document.addEventListener('click', closeFabMenu);

        function initFabLinks() {
            const user = localStorage.getItem(USER_KEY) ? JSON.parse(localStorage.getItem(USER_KEY)) : null;
            const token = localStorage.getItem(TOKEN_KEY);
            const isAdmin = localStorage.getItem('isAdmin') === 'true';

            const loginBtn = document.getElementById('fab-login-btn');
            const ordersBtn = document.getElementById('fab-orders-btn');
            const adminBtn = document.getElementById('fab-admin-btn');
            const logoutBtn = document.getElementById('fab-logout-btn');
            const fabToggle = document.getElementById('integrated-fab-toggle');

            if (user && token) {
                // User is logged in
                fabToggle.innerHTML = `<i data-lucide="user" class="bottom-menu-icon !w-5 !h-5 !mr-2"></i><span class="bottom-menu-title !text-base !font-semibold !opacity-100 !max-w-full !transition-none">${user.name.split(' ')[0]}</span>`;
                fabToggle.onclick = toggleFab;

                loginBtn.classList.add('hidden');
                ordersBtn.classList.remove('hidden');
                logoutBtn.classList.remove('hidden');

                if (isAdmin) {
                    adminBtn.classList.remove('hidden');
                } else {
                    adminBtn.classList.add('hidden');
                }
            } else {
                // User is logged out
                fabToggle.innerHTML = `<i data-lucide="log-in" class="bottom-menu-icon !w-5 !h-5 !mr-2"></i><span class="bottom-menu-title !text-base !font-semibold !opacity-100 !max-w-full !transition-none">Login</span>`;
                fabToggle.onclick = () => window.location.href = 'index.html'; // Arahkan ke index untuk memunculkan modal login

                loginBtn.classList.remove('hidden');
                ordersBtn.classList.add('hidden');
                adminBtn.classList.add('hidden');
                logoutBtn.classList.add('hidden');
            }
            lucide.createIcons();
        }

        // Daftarkan fungsi global yang dibutuhkan oleh HTML (hanya yang diperlukan di sini)
        window.toggleTheme = toggleTheme;
        window.handleLogout = handleLogout;
        window.toggleFab = toggleFab;
        window.closeFabMenu = closeFabMenu;
    </script>
</body>

</html>
